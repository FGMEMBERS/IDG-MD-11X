<?xml version="1.0"?>

<!-- McDonnell Douglas MD-11 Hydraulic System -->
<!-- Copyright (c) 2019 Joshua Davidson (it0uchpods) -->

<system name="MD-11: Hydraulics">
	
	<property value="500">/systems/hydraulics/sys-incr-rate</property> <!-- 2 seconds per 1000 psi -->
	<property value="0">/systems/hydraulics/rmp/sys-1-to-sys-3</property>
	<property value="0">/systems/hydraulics/rmp/sys-2-to-sys-3</property>
	<property value="0">/systems/hydraulics/rmp/sys-3-to-sys-1</property>
	<property value="0">/systems/hydraulics/rmp/sys-3-to-sys-2</property>
	<property value="0">/systems/hydraulics/rmp/sys-multi-thru-sys-3</property>
	
	<channel name="Main Hydraulics" execrate="8">
		
		<switch name="/systems/hydraulics/sys-decr-rate">
			<default value="45.45455"/> <!-- 22 seconds per 1000 psi -->
			<test value="500"> <!-- 2 seconds per 1000 psi for ACCONFIG -->
				/systems/acconfig/autoconfig-running eq 1
			</test>
		</switch>
		
		<!-- SYS 1 -->
		<fcs_function name="/systems/hydraulics/l-eng-1-pump-psi-input">
			<function>
				<ifthen>
					<nq>
						<property>/systems/failures/hydraulics/l-pump-1</property>
						<value>1</value>
					</nq>
					<table>
						<independentVar lookup="row">/engines/engine[2]/n2-actual</independentVar>
						<tableData>
							50    40
							55  2990
						</tableData>
					</table>
					<value>40</value>
				</ifthen>
			</function>
		</fcs_function>
		
		<switch name="/systems/hydraulics/l-eng-1-pump-psi">
			<default value="40"/>
			<test value="/systems/hydraulics/l-eng-1-pump-psi-input">
				/controls/hydraulics/switches/l-pump-1 eq 1
			</test>
		</switch>
		
		<fcs_function name="/systems/hydraulics/r-eng-1-pump-psi-input">
			<function>
				<ifthen>
					<nq>
						<property>/systems/failures/hydraulics/r-pump-1</property>
						<value>1</value>
					</nq>
					<table>
						<independentVar lookup="row">/engines/engine[2]/n2-actual</independentVar>
						<tableData>
							50    40
							55  2990
						</tableData>
					</table>
					<value>40</value>
				</ifthen>
			</function>
		</fcs_function>
		
		<switch name="/systems/hydraulics/r-eng-1-pump-status">
			<default value="0"/>
			<test logic="AND" value="1"> <!-- ON -->
				/controls/hydraulics/switches/r-pump-1 eq 1
				/systems/hydraulics/l-eng-1-pump-psi lt 2400
				/systems/hydraulics/r-eng-1-pump-psi-input ge 2400
			</test>
			<test value="-1"> <!-- ARM -->
				/controls/hydraulics/switches/r-pump-1 eq 1
			</test>
		</switch>
		
		<switch name="/systems/hydraulics/r-eng-1-pump-psi">
			<default value="40"/>
			<test value="/systems/hydraulics/r-eng-1-pump-psi-input">
				/systems/hydraulics/r-eng-1-pump-status eq 1
			</test>
		</switch>
		
		<fcs_function name="/systems/hydraulics/sys-1-pre-psi-cmd">
			<function>
				<ifthen>
					<ge>
						<property>/systems/hydraulics/sys-1-qty</property>
						<value>1.0</value>
					</ge>
					<max>
						<property>/systems/hydraulics/l-eng-1-pump-psi</property>
						<property>/systems/hydraulics/r-eng-1-pump-psi</property>
					</max>
					<value>40</value>
				</ifthen>
			</function>
		</fcs_function>
		
		<fcs_function name="/systems/hydraulics/sys-1-psi-cmd">
			<function>
				<ifthen>
					<ge>
						<property>/systems/hydraulics/sys-1-qty</property>
						<value>1.0</value>
					</ge>
					<max>
						<property>/systems/hydraulics/sys-1-pre-psi-cmd</property>
						<property>/systems/hydraulics/rmp/sys-3-to-sys-1</property>
						<property>/systems/hydraulics/rmp/sys-multi-thru-sys-3</property>
					</max>
					<value>40</value>
				</ifthen>
			</function>
		</fcs_function>
		
		<actuator name="/systems/hydraulics/sys-1-psi">
			<input>/systems/hydraulics/sys-1-psi-cmd</input>
			<rate_limit sense="incr">/systems/hydraulics/sys-incr-rate</rate_limit>
			<rate_limit sense="decr">/systems/hydraulics/sys-decr-rate</rate_limit>
			<output>/systems/hydraulics/sys-1-psi-debug</output>
		</actuator>
		
		<!-- SYS 2 -->
		<fcs_function name="/systems/hydraulics/l-eng-2-pump-psi-input">
			<function>
				<ifthen>
					<nq>
						<property>/systems/failures/hydraulics/l-pump-2</property>
						<value>1</value>
					</nq>
					<table>
						<independentVar lookup="row">/engines/engine[1]/n2-actual</independentVar>
						<tableData>
							50    40
							55  3010
						</tableData>
					</table>
					<value>40</value>
				</ifthen>
			</function>
		</fcs_function>
		
		<switch name="/systems/hydraulics/l-eng-2-pump-psi">
			<default value="40"/>
			<test value="/systems/hydraulics/l-eng-2-pump-psi-input">
				/controls/hydraulics/switches/l-pump-2 eq 1
			</test>
		</switch>
		
		<fcs_function name="/systems/hydraulics/r-eng-2-pump-psi-input">
			<function>
				<ifthen>
					<nq>
						<property>/systems/failures/hydraulics/r-pump-2</property>
						<value>1</value>
					</nq>
					<table>
						<independentVar lookup="row">/engines/engine[1]/n2-actual</independentVar>
						<tableData>
							50    40
							55  3010
						</tableData>
					</table>
					<value>40</value>
				</ifthen>
			</function>
		</fcs_function>
		
		<switch name="/systems/hydraulics/r-eng-2-pump-status">
			<default value="0"/>
			<test logic="AND" value="1"> <!-- ON -->
				/controls/hydraulics/switches/r-pump-2 eq 1
				/systems/hydraulics/l-eng-2-pump-psi lt 2400
				/systems/hydraulics/r-eng-2-pump-psi-input ge 2400
			</test>
			<test value="-2"> <!-- ARM -->
				/controls/hydraulics/switches/r-pump-2 eq 1
			</test>
		</switch>
		
		<switch name="/systems/hydraulics/r-eng-2-pump-psi">
			<default value="40"/>
			<test value="/systems/hydraulics/r-eng-2-pump-psi-input">
				/systems/hydraulics/r-eng-2-pump-status eq 1
			</test>
		</switch>
		
		<fcs_function name="/systems/hydraulics/sys-2-pre-psi-cmd">
			<function>
				<ifthen>
					<ge>
						<property>/systems/hydraulics/sys-2-qty</property>
						<value>1.0</value>
					</ge>
					<max>
						<property>/systems/hydraulics/l-eng-2-pump-psi</property>
						<property>/systems/hydraulics/r-eng-2-pump-psi</property>
					</max>
					<value>40</value>
				</ifthen>
			</function>
		</fcs_function>
		
		<fcs_function name="/systems/hydraulics/sys-2-psi-cmd">
			<function>
				<ifthen>
					<ge>
						<property>/systems/hydraulics/sys-2-qty</property>
						<value>1.0</value>
					</ge>
					<max>
						<property>/systems/hydraulics/sys-2-pre-psi-cmd</property>
						<property>/systems/hydraulics/rmp/sys-3-to-sys-2</property>
						<property>/systems/hydraulics/rmp/sys-multi-thru-sys-3</property>
					</max>
					<value>40</value>
				</ifthen>
			</function>
		</fcs_function>
		
		<actuator name="/systems/hydraulics/sys-2-psi">
			<input>/systems/hydraulics/sys-2-psi-cmd</input>
			<rate_limit sense="incr">/systems/hydraulics/sys-incr-rate</rate_limit>
			<rate_limit sense="decr">/systems/hydraulics/sys-decr-rate</rate_limit>
			<output>/systems/hydraulics/sys-2-psi-debug</output>
		</actuator>
		
		<!-- SYS 3 -->
		<fcs_function name="/systems/hydraulics/l-eng-3-pump-psi-input">
			<function>
				<ifthen>
					<nq>
						<property>/systems/failures/hydraulics/l-pump-3</property>
						<value>1</value>
					</nq>
					<table>
						<independentVar lookup="row">/engines/engine[2]/n2-actual</independentVar>
						<tableData>
							50    40
							55  2980
						</tableData>
					</table>
					<value>40</value>
				</ifthen>
			</function>
		</fcs_function>
		
		<switch name="/systems/hydraulics/l-eng-3-pump-psi">
			<default value="40"/>
			<test value="/systems/hydraulics/l-eng-3-pump-psi-input">
				/controls/hydraulics/switches/l-pump-3 eq 1
			</test>
		</switch>
		
		<fcs_function name="/systems/hydraulics/r-eng-3-pump-psi-input">
			<function>
				<ifthen>
					<nq>
						<property>/systems/failures/hydraulics/r-pump-3</property>
						<value>1</value>
					</nq>
					<table>
						<independentVar lookup="row">/engines/engine[2]/n2-actual</independentVar>
						<tableData>
							50    40
							55  2980
						</tableData>
					</table>
					<value>40</value>
				</ifthen>
			</function>
		</fcs_function>
		
		<switch name="/systems/hydraulics/r-eng-3-pump-status">
			<default value="0"/>
			<test logic="AND" value="1"> <!-- ON -->
				/controls/hydraulics/switches/r-pump-3 eq 1
				/systems/hydraulics/l-eng-3-pump-psi lt 2400
				/systems/hydraulics/r-eng-3-pump-psi-input ge 2400
			</test>
			<test value="-3"> <!-- ARM -->
				/controls/hydraulics/switches/r-pump-3 eq 1
			</test>
		</switch>
		
		<switch name="/systems/hydraulics/r-eng-3-pump-psi">
			<default value="40"/>
			<test value="/systems/hydraulics/r-eng-3-pump-psi-input">
				/systems/hydraulics/r-eng-3-pump-status eq 1
			</test>
		</switch>
		
		<switch name="/systems/hydraulics/aux-pump-1-psi">
			<default value="0"/>
			<test value="0">
				/controls/hydraulics/switches/aux-pump-1 ne 1
			</test>
			<test logic="AND" value="0"> <!-- ADG can't do both ELEC and HYD -->
				/controls/electrical/switches/adg-elec eq 1
				/systems/electrical/sources/adg/output-volt ge 110
			</test>
			<test logic="OR" value="2960"> <!-- I know it is powered by an AC bus, but I don't know which one, so guesses -->
				/systems/electrical/bus/ac-1 ge 110
				/systems/electrical/bus/ac-2 ge 110
				/systems/electrical/bus/ac-3 ge 110
				/systems/electrical/bus/l-emer-ac ge 110
				/systems/electrical/bus/r-emer-ac ge 110
			</test>
		</switch>
		
		<switch name="/systems/hydraulics/aux-pump-2-psi">
			<default value="0"/>
			<test value="0">
				/controls/hydraulics/switches/aux-pump-2 ne 1
			</test>
			<test logic="OR" value="2950"> <!-- I know it is powered by an AC bus, but I don't know which one, so guesses -->
				/systems/electrical/bus/ac-1 ge 110
				/systems/electrical/bus/ac-2 ge 110
				/systems/electrical/bus/ac-3 ge 110
			</test>
		</switch>
		
		<fcs_function name="/systems/hydraulics/sys-3-pre-psi-cmd">
			<function>
				<ifthen>
					<ge>
						<property>/systems/hydraulics/sys-3-qty</property>
						<value>1.0</value>
					</ge>
					<max>
						<property>/systems/hydraulics/l-eng-3-pump-psi</property>
						<property>/systems/hydraulics/r-eng-3-pump-psi</property>
						<property>/systems/hydraulics/aux-pump-1-psi</property>
						<property>/systems/hydraulics/aux-pump-2-psi</property>
					</max>
					<value>40</value>
				</ifthen>
			</function>
		</fcs_function>
		
		<fcs_function name="/systems/hydraulics/sys-3-rmp-psi-cmd">
			<function>
				<ifthen>
					<ge>
						<property>/systems/hydraulics/sys-3-qty</property>
						<value>1.0</value>
					</ge>
					<max>
						<property>/systems/hydraulics/rmp/sys-1-to-sys-3</property>
						<property>/systems/hydraulics/rmp/sys-2-to-sys-3</property>
					</max>
					<value>40</value>
				</ifthen>
			</function>
		</fcs_function>
		
		<fcs_function name="/systems/hydraulics/sys-3-psi-cmd">
			<function>
				<max>
					<property>/systems/hydraulics/sys-3-pre-psi-cmd</property>
					<property>/systems/hydraulics/sys-3-rmp-psi-cmd</property>
				</max>
			</function>
		</fcs_function>
		
		<actuator name="/systems/hydraulics/sys-3-psi">
			<input>/systems/hydraulics/sys-3-psi-cmd</input>
			<rate_limit sense="incr">/systems/hydraulics/sys-incr-rate</rate_limit>
			<rate_limit sense="decr">/systems/hydraulics/sys-decr-rate</rate_limit>
			<output>/systems/hydraulics/sys-3-psi-debug</output>
		</actuator>
		
		<!-- Reversible Motor Pump 1-3 -->
		<switch name="/systems/hydraulics/rmp/sys-1-to-sys-3">
			<default value="0"/>
			<test logic="AND" value="/systems/hydraulics/sys-1-pre-psi-cmd">
				/controls/hydraulics/switches/rmp-1-3 eq 1
				/systems/failures/hydraulics/rmp-1-3 ne 1
			</test>
		</switch>
		
		<switch name="/systems/hydraulics/rmp/sys-3-to-sys-1">
			<default value="0"/>
			<test logic="AND" value="/systems/hydraulics/sys-3-pre-psi-cmd">
				/controls/hydraulics/switches/rmp-1-3 eq 1
				/systems/failures/hydraulics/rmp-1-3 ne 1
			</test>
		</switch>
		
		<!-- Reversible Motor Pump 2-3 -->
		<switch name="/systems/hydraulics/rmp/sys-2-to-sys-3">
			<default value="0"/>
			<test logic="AND" value="/systems/hydraulics/sys-2-pre-psi-cmd">
				/controls/hydraulics/switches/rmp-2-3 eq 1
				/systems/failures/hydraulics/rmp-2-3 ne 1
			</test>
		</switch>
		
		<switch name="/systems/hydraulics/rmp/sys-3-to-sys-2">
			<default value="0"/>
			<test logic="AND" value="/systems/hydraulics/sys-3-pre-psi-cmd">
				/controls/hydraulics/switches/rmp-2-3 eq 1
				/systems/failures/hydraulics/rmp-2-3 ne 1
			</test>
		</switch>
		
		<!-- Reversible Motor Pump Multi -->
		<switch name="/systems/hydraulics/rmp/sys-multi-thru-sys-3">
			<default value="0"/>
			<test logic="AND" value="/systems/hydraulics/sys-3-rmp-psi-cmd">
				/controls/hydraulics/switches/rmp-1-3 eq 1
				/systems/failures/hydraulics/rmp-1-3 ne 1
				/controls/hydraulics/switches/rmp-2-3 eq 1
				/systems/failures/hydraulics/rmp-2-3 ne 1
			</test>
		</switch>
	
	</channel>
	
	<channel name="Overhead Lights" execrate="8">
		
		<switch name="/systems/hydraulics/light/l-pump-1-fault">
			<default value="0"/>
			<test value="1">
				/systems/hydraulics/l-eng-1-pump-psi-input lt 2400
			</test>
		</switch>
		
		<switch name="/systems/hydraulics/light/r-pump-1-fault">
			<default value="0"/>
			<test value="1">
				/systems/hydraulics/r-eng-1-pump-psi-input lt 2400
			</test>
		</switch>
		
		<switch name="/systems/hydraulics/light/l-pump-2-fault">
			<default value="0"/>
			<test value="1">
				/systems/hydraulics/l-eng-2-pump-psi-input lt 2400
			</test>
		</switch>
		
		<switch name="/systems/hydraulics/light/r-pump-2-fault">
			<default value="0"/>
			<test value="1">
				/systems/hydraulics/r-eng-2-pump-psi-input lt 2400
			</test>
		</switch>
		
		<switch name="/systems/hydraulics/light/l-pump-3-fault">
			<default value="0"/>
			<test value="1">
				/systems/hydraulics/l-eng-3-pump-psi-input lt 2400
			</test>
		</switch>
		
		<switch name="/systems/hydraulics/light/r-pump-3-fault">
			<default value="0"/>
			<test value="1">
				/systems/hydraulics/r-eng-3-pump-psi-input lt 2400
			</test>
		</switch>
	
	</channel>

</system>
